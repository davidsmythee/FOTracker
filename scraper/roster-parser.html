<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lacrosse Roster Parser</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f9fafb;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            color: #111827;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #6b7280;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .instructions {
            background: #eff6ff;
            border-left: 4px solid #3b82f6;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .instructions h3 {
            color: #1e40af;
            margin-bottom: 10px;
        }

        .instructions ol {
            margin-left: 20px;
            color: #374151;
        }

        .instructions li {
            margin-bottom: 8px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
        }

        input[type="text"],
        input[type="url"],
        textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
        }

        textarea {
            min-height: 200px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #1f2937;
            color: white;
        }

        .btn-primary:hover {
            background: #374151;
        }

        .btn-secondary {
            background: white;
            color: #1f2937;
            border: 1px solid #e5e7eb;
        }

        .btn-secondary:hover {
            background: #f9fafb;
        }

        .results {
            display: none;
        }

        .results.show {
            display: block;
        }

        .stats {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            flex: 1;
            background: #f3f4f6;
            padding: 16px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: #1f2937;
        }

        .stat-label {
            font-size: 14px;
            color: #6b7280;
            margin-top: 4px;
        }

        .json-output {
            background: #1f2937;
            color: #f3f4f6;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            overflow-x: auto;
            white-space: pre;
            max-height: 500px;
            overflow-y: auto;
        }

        .player-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .player-table th {
            background: #f3f4f6;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: #374151;
            border-bottom: 2px solid #e5e7eb;
        }

        .player-table td {
            padding: 12px;
            border-bottom: 1px solid #e5e7eb;
            color: #1f2937;
        }

        .player-table tr:hover {
            background: #f9fafb;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .alert {
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #6ee7b7;
        }

        .alert-warning {
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #fcd34d;
        }

        .alert-error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fca5a5;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ü•ç Lacrosse Roster Parser</h1>
        <p class="subtitle">Extract player names, numbers, and positions from roster pages</p>

        <div class="instructions">
            <h3>üìã How to Use:</h3>
            <ol>
                <li>Go to a team's roster page (e.g., <code>goprincetontigers.com/sports/mens-lacrosse/roster</code>)</li>
                <li>Right-click anywhere on the page ‚Üí "View Page Source" or press <code>Ctrl+U</code> (Windows) / <code>Cmd+Option+U</code> (Mac)</li>
                <li>Copy all the HTML (Ctrl+A / Cmd+A, then Ctrl+C / Cmd+C)</li>
                <li>Paste it into the "HTML Content" box below</li>
                <li>Enter the team name and source URL</li>
                <li>Click "Parse Roster"</li>
            </ol>
        </div>

        <div class="card">
            <form id="parser-form">
                <div class="form-group">
                    <label for="team-name">Team Name:</label>
                    <select id="team-name" required>
                        <option value="">Select a team...</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="html-content">HTML Content (paste page source here):</label>
                    <textarea id="html-content" placeholder="Paste the full HTML source code here..." required></textarea>
                </div>

                <button type="submit" class="btn btn-primary">Parse Roster</button>
            </form>
        </div>

        <div id="results" class="results">
            <div id="alert-container"></div>

            <div class="card">
                <h2>Results</h2>
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-value" id="player-count">0</div>
                        <div class="stat-label">Players Found</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="position-count">0</div>
                        <div class="stat-label">With Positions</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="number-count">0</div>
                        <div class="stat-label">With Numbers</div>
                    </div>
                </div>

                <table class="player-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Name</th>
                            <th>Number</th>
                            <th>Position</th>
                            <th>Class Year</th>
                        </tr>
                    </thead>
                    <tbody id="player-table-body">
                    </tbody>
                </table>
            </div>

            <div class="card">
                <h2>JSON Output</h2>
                <p style="color: #6b7280; margin-bottom: 15px;">Copy this JSON to import players into your system</p>
                <div class="json-output" id="json-output"></div>
                <div class="button-group">
                    <button class="btn btn-primary" onclick="copyJSON()">üìã Copy JSON</button>
                    <button class="btn btn-secondary" onclick="downloadJSON()">üíæ Download JSON</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let parsedData = null;

        // D1 Lacrosse Schools
        const d1LacrosseSchools = [
            { name: "Bellarmine University" },
            { name: "Boston University" },
            { name: "Brown University" },
            { name: "Bryant University" },
            { name: "Bucknell University" },
            { name: "Canisius College" },
            { name: "Cleveland State University" },
            { name: "Colgate University" },
            { name: "College of the Holy Cross" },
            { name: "Cornell University" },
            { name: "Dartmouth College" },
            { name: "Drexel University" },
            { name: "Duke University" },
            { name: "Fairfield University" },
            { name: "Georgetown University" },
            { name: "Hampton University" },
            { name: "Harvard University" },
            { name: "High Point University" },
            { name: "Hobart & William Smith College" },
            { name: "Hofstra University" },
            { name: "Iona University" },
            { name: "Jacksonville University" },
            { name: "Johns Hopkins University" },
            { name: "Lafayette College" },
            { name: "Lehigh University" },
            { name: "Lindenwood University" },
            { name: "Long Island University" },
            { name: "Loyola University Maryland" },
            { name: "Manhattan College" },
            { name: "Marist College" },
            { name: "Marquette University" },
            { name: "Mercer University" },
            { name: "Merrimack College" },
            { name: "Monmouth University" },
            { name: "Mount St. Mary's University" },
            { name: "New Jersey Institute of Technology" },
            { name: "Ohio State University" },
            { name: "Penn State" },
            { name: "Princeton University" },
            { name: "Providence College" },
            { name: "Queens University of Charlotte" },
            { name: "Quinnipiac University" },
            { name: "Robert Morris University" },
            { name: "Rutgers University" },
            { name: "Sacred Heart University" },
            { name: "Saint Joseph's University" },
            { name: "Siena College" },
            { name: "St. Bonaventure University" },
            { name: "St. John's University" },
            { name: "SUNY Binghamton University" },
            { name: "SUNY Stony Brook University" },
            { name: "SUNY University at Albany" },
            { name: "Syracuse University" },
            { name: "Towson University" },
            { name: "United States Air Force Academy" },
            { name: "United States Military Academy" },
            { name: "United States Naval Academy" },
            { name: "University of Delaware" },
            { name: "University of Denver" },
            { name: "University of Detroit Mercy" },
            { name: "University of Maryland" },
            { name: "University of Maryland ‚Äì Baltimore County" },
            { name: "University of Massachusetts ‚Äì Amherst" },
            { name: "University of Massachusetts ‚Äì Lowell" },
            { name: "University of Michigan" },
            { name: "University of North Carolina at Chapel Hill" },
            { name: "University of Notre Dame" },
            { name: "University of Pennsylvania" },
            { name: "University of Richmond" },
            { name: "University of Utah" },
            { name: "University of Vermont" },
            { name: "University of Virginia" },
            { name: "Villanova University" },
            { name: "Virginia Military Institute" },
            { name: "Wagner College" },
            { name: "Yale University" }
        ];

        // Populate team dropdown
        const teamSelect = document.getElementById('team-name');
        d1LacrosseSchools.forEach(school => {
            const option = document.createElement('option');
            option.value = school.name;
            option.textContent = school.name;
            teamSelect.appendChild(option);
        });

        document.getElementById('parser-form').addEventListener('submit', function(e) {
            e.preventDefault();
            parseRoster();
        });

        function parseRoster() {
            const teamName = document.getElementById('team-name').value.trim();
            const htmlContent = document.getElementById('html-content').value;

            if (!teamName || !htmlContent) {
                showAlert('Please fill in all fields', 'error');
                return;
            }

            const players = extractPlayers(htmlContent);

            if (players.length === 0) {
                showAlert('No players found. The page structure may not be recognized. Try a different roster page or check the HTML content.', 'warning');
                return;
            }

            // Create output
            parsedData = {
                team: teamName,
                scrapedAt: new Date().toISOString(),
                playerCount: players.length,
                players: players
            };

            displayResults(parsedData);
            showAlert(`Successfully parsed ${players.length} players!`, 'success');
        }

        function extractPlayers(html) {
            const players = [];
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');

            // Strategy 1: Find table rows with player data
            const tableRows = doc.querySelectorAll('tr');

            tableRows.forEach(row => {
                const cells = Array.from(row.querySelectorAll('td')).map(td => td.textContent.trim());

                if (cells.length >= 2) {
                    let number = '';
                    let name = '';
                    let position = '';
                    let classYear = '';

                    // Detect which cell contains what
                    cells.forEach(cell => {
                        const cellLower = cell.toLowerCase();

                        // Number: 1-2 digits, possibly with #
                        if (/^#?\d{1,2}$/.test(cell) && !number) {
                            number = cell.replace('#', '');
                        }
                        // Class Year: Check for year keywords
                        else if (!classYear && (
                            cellLower === 'fr' || cellLower === 'fr.' ||
                            cellLower === 'so' || cellLower === 'so.' ||
                            cellLower === 'jr' || cellLower === 'jr.' ||
                            cellLower === 'sr' || cellLower === 'sr.' ||
                            cellLower.includes('freshman') || cellLower.includes('fresh.') ||
                            cellLower.includes('sophomore') || cellLower.includes('soph.') ||
                            cellLower.includes('junior') ||
                            cellLower.includes('senior') ||
                            cellLower.includes('graduate') || cellLower === 'grad' || cellLower === 'gr'
                        )) {
                            classYear = cell;
                        }
                        // Position: Check for position-related keywords (more flexible matching)
                        else if (!position && (
                            cellLower.includes('fogo') || cellLower.includes('face') || cellLower === 'fo' || cellLower === 'f/o' || cellLower.includes('m/fo') || cellLower.includes('/fo') ||
                            cellLower.includes('lsm') || cellLower.includes('long stick') ||
                            cellLower.includes('ssdm') || (cellLower.includes('short stick') && cellLower.includes('def')) ||
                            cellLower === 'a' || cellLower === 'att' || cellLower.includes('attack') ||
                            cellLower === 'm' || cellLower === 'mid' || cellLower.includes('midfield') ||
                            cellLower === 'd' || cellLower === 'def' || cellLower.includes('defense') || cellLower.includes('defender') ||
                            cellLower === 'g' || cellLower.includes('goal') || cellLower.includes('keeper')
                        )) {
                            position = cell;
                        }
                        // Name: Has spaces and capitalized words
                        else if (/^[A-Z][a-z]+(\s+[A-Z][a-z]+)+$/.test(cell) && !name) {
                            name = cell;
                        }
                    });

                    // Fallback: positional parsing
                    if (!name && cells.length >= 2) {
                        name = cells.find(c => /^[A-Z][a-z]+/.test(c)) || cells[1];
                    }
                    if (!number) {
                        number = cells.find(c => /^\d{1,2}$/.test(c)) || '';
                    }
                    if (!classYear) {
                        classYear = cells.find(c => {
                            const lower = c.toLowerCase();
                            return lower === 'fr' || lower === 'fr.' ||
                                   lower === 'so' || lower === 'so.' ||
                                   lower === 'jr' || lower === 'jr.' ||
                                   lower === 'sr' || lower === 'sr.' ||
                                   lower.includes('freshman') || lower.includes('sophomore') ||
                                   lower.includes('junior') || lower.includes('senior') ||
                                   lower.includes('graduate') || lower === 'grad' || lower === 'gr';
                        }) || '';
                    }
                    if (!position) {
                        // More flexible position detection
                        position = cells.find(c => {
                            const lower = c.toLowerCase();
                            return lower.includes('fogo') || lower.includes('face') || lower === 'fo' || lower === 'f/o' || lower.includes('m/fo') || lower.includes('/fo') ||
                                   lower.includes('lsm') || lower.includes('long stick') ||
                                   lower.includes('ssdm') || lower.includes('short stick') ||
                                   lower === 'a' || lower === 'att' || lower.includes('attack') ||
                                   lower === 'm' || lower === 'mid' || lower.includes('midfield') ||
                                   lower === 'd' || lower === 'def' || lower.includes('defense') ||
                                   lower === 'g' || lower.includes('goal');
                        }) || '';
                    }

                    // Only include if they have a name, number, AND position (filters out coaches/staff)
                    if (name && name.length > 2 && number && position) {
                        players.push({
                            name: name.trim(),
                            number: number.toString().trim(),
                            position: normalizePosition(position.trim()),
                            classYear: normalizeClassYear(classYear.trim()),
                            team: document.getElementById('team-name').value.trim()
                        });
                    }
                }
            });

            // Strategy 2: Look for divs with player cards
            if (players.length === 0) {
                const playerCards = doc.querySelectorAll('[class*="player"], [class*="roster"], [class*="athlete"]');

                playerCards.forEach(card => {
                    const nameEl = card.querySelector('[class*="name"]');
                    const numberEl = card.querySelector('[class*="number"], [class*="jersey"]');
                    const positionEl = card.querySelector('[class*="position"]');
                    const classYearEl = card.querySelector('[class*="year"], [class*="class"]');

                    const name = nameEl ? nameEl.textContent.trim() : '';
                    const number = numberEl ? numberEl.textContent.replace(/\D/g, '') : '';
                    const position = positionEl ? positionEl.textContent.trim() : '';
                    const classYear = classYearEl ? classYearEl.textContent.trim() : '';

                    // Only include if they have a name, number, AND position (filters out coaches/staff)
                    if (nameEl && number && position) {
                        players.push({
                            name: name,
                            number: number,
                            position: normalizePosition(position),
                            classYear: normalizeClassYear(classYear),
                            team: document.getElementById('team-name').value.trim()
                        });
                    }
                });
            }

            return players;
        }

        function normalizePosition(position) {
            if (!position) return '';

            const pos = position.toLowerCase().trim();

            // Face-off specialists (many variations)
            if (pos.includes('fogo') || pos.includes('face') || pos === 'fo' || pos === 'f/o' || pos.includes('m/fo') || pos.includes('/fo')) return 'FOGO';

            // Long Stick Midfielder
            if (pos.includes('lsm') || pos.includes('long stick')) return 'LSM';

            // Short Stick Defensive Midfielder
            if (pos.includes('ssdm') || (pos.includes('short stick') && pos.includes('def'))) return 'SSDM';

            // Attack
            if (pos === 'a' || pos === 'att' || pos.includes('attack')) return 'Attack';

            // Midfielder
            if (pos === 'm' || pos === 'mid' || pos.includes('midfield')) return 'Midfielder';

            // Defense
            if (pos === 'd' || pos === 'def' || pos.includes('defense') || pos.includes('defender')) return 'Defense';

            // Goalie
            if (pos === 'g' || pos.includes('goal') || pos.includes('keeper')) return 'Goalie';

            // Return original with first letter capitalized if no match
            return position.charAt(0).toUpperCase() + position.slice(1);
        }

        function normalizeClassYear(classYear) {
            if (!classYear) return '';

            const year = classYear.toLowerCase().trim();

            // Freshman variations
            if (year === 'fr' || year === 'fr.' || year.includes('freshman') || year.includes('fresh.')) return 'Freshman';

            // Sophomore variations
            if (year === 'so' || year === 'so.' || year.includes('sophomore') || year.includes('soph.')) return 'Sophomore';

            // Junior variations
            if (year === 'jr' || year === 'jr.' || year.includes('junior')) return 'Junior';

            // Senior variations
            if (year === 'sr' || year === 'sr.' || year.includes('senior')) return 'Senior';

            // Graduate variations
            if (year === 'gr' || year === 'gr.' || year === 'grad' || year.includes('graduate')) return 'Graduate';

            // Return original with first letter capitalized if no match
            return classYear.charAt(0).toUpperCase() + classYear.slice(1);
        }

        function displayResults(data) {
            // Show results section
            document.getElementById('results').classList.add('show');

            // Update stats
            document.getElementById('player-count').textContent = data.players.length;
            document.getElementById('position-count').textContent = data.players.filter(p => p.position).length;
            document.getElementById('number-count').textContent = data.players.filter(p => p.number).length;

            // Populate table
            const tbody = document.getElementById('player-table-body');
            tbody.innerHTML = '';

            data.players.forEach((player, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td><strong>${player.name}</strong></td>
                    <td>${player.number || '‚Äî'}</td>
                    <td>${player.position || '‚Äî'}</td>
                    <td>${player.classYear || '‚Äî'}</td>
                `;
                tbody.appendChild(row);
            });

            // Display JSON
            document.getElementById('json-output').textContent = JSON.stringify(data, null, 2);

            // Scroll to results
            document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
        }

        function showAlert(message, type) {
            const alertContainer = document.getElementById('alert-container');
            const alertClass = type === 'success' ? 'alert-success' : type === 'warning' ? 'alert-warning' : 'alert-error';

            alertContainer.innerHTML = `<div class="alert ${alertClass}">${message}</div>`;

            setTimeout(() => {
                alertContainer.innerHTML = '';
            }, 5000);
        }

        function copyJSON() {
            const jsonText = document.getElementById('json-output').textContent;
            navigator.clipboard.writeText(jsonText).then(() => {
                showAlert('JSON copied to clipboard!', 'success');
            });
        }

        function downloadJSON() {
            if (!parsedData) return;

            const jsonText = JSON.stringify(parsedData, null, 2);
            const blob = new Blob([jsonText], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `roster-${parsedData.team.toLowerCase().replace(/\s+/g, '-')}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            showAlert('JSON file downloaded!', 'success');
        }
    </script>
</body>
</html>
